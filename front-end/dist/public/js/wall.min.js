/*! pegara-brain-salvation - v0.0.1 ( 2016-04-28 ) - MIT */
!function(a){/**
 * namespace
 * PBS = Pegara's Brain Salvation
 */
var b=a.PBS={},c=b.Util={},d=b.Widget={},e=b.Page={},f=b.Route={all:".",rrs:"^/rrs?",profile:"^/rrs/profile",score:"^/rrs/score",survey:"^/survey/form"};/**
 * on domContentLoaded
 */
$(function(){
// All pages
c.dispatcher(f.all,function(){e.all.init()}),
// RRS form page
c.dispatcher(f.rrs,function(){e.rrs.init()}),
// RRS profile form page
c.dispatcher(f.profile,function(){e.profile.init()}),
// RRS score page
c.dispatcher(f.score,function(){e.score.init()}),
// Survey page
c.dispatcher(f.survey,function(){e.survey.init()});
// dispatch
var a=location.pathname;c.dispatcher(a)}),c.dispatcher=function(a,b){if(this.page_func=this.page_func||[],b)return this.page_func.push([a,b]);for(var c=0,d=this.page_func.length;d>c;++c){var e=this.page_func[c],f=a.match(e[0]);f&&e[1](f)}},c.string=function(){return{/*
     * @param {String}
     * @return {String}
     */
sprintf:function(a){for(var b=/(%d|%s){1}/,c=[],d=arguments.length,e=1;d>e;e++)c.push(arguments[e]);d=c.length;for(var f=a,e=0;d>e;e++)f=f.replace(b,c[e]);return f},/*
     * @param {String}
     * @return {String}
     */
stripHTML:function(a){var b=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a.replace(b,"")},/*
     * @param {String/Number}
     * @param {Number}
     * @param {String}
     * @return {String}
     */
leftPad:function(a,b,c){c=c||"0",b=b||0;for(var d="",e=0;b>e;e++)d+=c;return(d+a).slice(-1*b)},/*
     * @param {Number}
     * @return {String}
     */
csv:function(a){return String(a).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}}}(),c.date=function(){
// Get date of today
var a=function(){
// Dateオブジェクトを生成
var a=new Date,b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),e=a.getHours(),f=a.getMinutes();return b+"-"+c+"-"+d+"-"+e+"-"+f};return{latest:{latestKey:"latest",/*
       * @return {Boolean}
       * ローカルストレイジを使って最近アクセスしたのが今日かどうか判定
       */
isToday:function(){var a=new Date,b=new Date(c.storage.get(this.latestKey)),d=a.getFullYear()===b.getFullYear(),e=a.getMonth()+1===b.getMonth()+1,f=a.getDate()===b.getDate(),g=a.getHours()<8;// バッチが十分に回りきったあとの時間がだいたい8時
return!!(d&&e&&f||g)},/*
       * @return {String} latestKey
       */
getLatestKey:function(){return this.latestKey}},today:a}}(),c.url=function(){return{/*
     * @param {String} path
     * @param {Object} query
     */
getQuery:function(a){var b={},c=[],d=[];return a&&/^\?.*=.*/.test(a)?(a=a.substr(1),c=a.split(/&/g),_.each(c,function(a,c){d=a.split(/=/),b[d[0]]=d[1]}),b):b},getLastPath:function(){return location.pathname.split("/").pop()},removeFirstPath:function(){var a=location.pathname,b=a.split("/");return b.splice(1,1),a=b.join("/")},concatPath:function(a,b){var c="/"===a.substr(-1,1),d="/"===b.substr(0,1),e="";return e=c===!0&&d===!0?a+b.substr(1):c===!0||d===!0?a+b:a+"/"+b}}}(),c.fetch=function(a){var b=MMS.Config.env,d=b.base_url,e=b.m_id,f=b.m_owner_id,g=b.user_id,h=b.referer,i=c.url.concatPath(d,"api/%s?"),j=$.Deferred(),k={m_id:e,m_owner_id:f,referer:h},l="";
// decide url.
return _.extend(k,a.params),i=c.string.sprintf(i,a.path),"ranking"!==a.type&&"category"!==a.type&&"killer"!==a.type&&"topKiller"!==a.type||_.extend(k,{user_id:g}),"notificationIncentive"===a.type&&_.extend(k,{type:a.notiType}),"viewHistory"===a.type&&_.extend(k,{type:a.params}),l=i+$.param(k),$.ajax({type:"GET",dataType:"json",url:l,success:j.resolve,error:j.reject}),j.promise()},c.dimension=function(b,c){/**
   * 表示領域のサイズを取得する
   *
   * @return {Object}
   */
function d(){return{width:b.innerWidth,height:b.innerHeight}}/**
   * スクロール量を取得する
   *
   * @return {Object}
   */
function e(){return{left:b.pageXOffset||c.documentElement.scrollLeft||c.body.scrollLeft,top:b.pageYOffset||c.documentElement.scrollTop||c.body.scrollTop}}/**
   * 要素の表示領域内の絶対座標と，矩形の幅と高さを返す ( border-boxモデル )
   * getBoundingClientRectの実装が必要
   *
   * @param {Element} elm
   * @return {Object}
   */
function f(a){var b=a.getBoundingClientRect();return{top:b.top,bottom:b.bottom,left:b.left,right:b.right,width:b.width||b.right-b.left,height:b.height||b.bottom-b.top}}/**
   * 要素の親要素との相対座標と，矩形の幅と高さを返す
   *
   * @param {Element} elm
   * @param {Element} [parent]
   * @return {Object}
   */
function g(a,b){var c=f(b||a.parentNode),d=f(a);return{top:d.top-c.top,bottom:c.bottom-d.bottom,left:d.left-c.left,right:c.right-d.right}}/**
   * 要素を中央に配置する
   * デフォルトはviewportに対しての中央
   *
   * @param {Element} elm
   * @param {Element} [crit]
   */
// @todo issue: ロジックの整理が必要
function h(a,b){function g(a){for(var b,d=a;d=d.parentNode;){
// documentに突き当たったら終了
if(d===c)return!1;if(b=a.style.position,"absolute"===b||"relative"===b)return d}return!1}var h,i,j=f(a),k={},l={},m={},n=!1;
// critがあって，スタイルのtop, leftと座標が異なれば相対基準をチェック
k.top=a.style.top,k.left=a.style.left,b&&j.top!==k.top&&j.left!==k.left&&(n=g(a)),
// 相対基準がいるか？
n!==!1?
// 相対基準とcritは同一か？
b&&b===n?(i=f(b),l.left=(i.width-j.width)/2+"px",l.top=(i.height-j.height)/2+"px"):(i=f(b),h=f(n),m.top=i.top-h.top,m.left=i.left-h.left,l.left=(i.width-j.width)/2+m.left+"px",l.top=(i.height-j.height)/2+m.top+"px"):b?(i=f(b),l.left=(i.width-j.width)/2+i.left+"px",l.top=(i.height-j.height)/2+i.top+"px"):(i=d(),m=e(),l.left=(i.width-j.width)/2+m.left+"px",l.top=(i.height-j.height)/2+m.top+"px"),Object.keys(l).forEach(function(b){a.style[b]=l[b]})}/**
   * 要素が範囲内にあるかどうか
   * @param {Object} $elm Element for check.
   * @param {Number} len Distance from window-bottom to top of $elm.
   * @return {Boolean}
   */
function i(b,c){var d=$(a),c=c||0,e={top:d.scrollTop()};e.bottom=e.top+d.height();var f=b.offset();return f.bottom=f.top+b.height(),!(e.bottom+c<f.top||e.top>f.bottom)}return{viewportSize:d,scrollPos:e,elCentering:h,elRelRectPos:g,elAbsRectPos:f,elIsOnRange:i}}(a,document),c.validation=function(){var a=function(a){var b,c,d,e,f,g={error:{}};return $(a+" .js-answer-key").each(function(a,h){var i=$(h);
//end
switch(d=i.get(0).tagName,e="INPUT"!==d?d:i.attr("type"),c="non-data",b=i.attr("name"),f=i.attr("data-required"),g.error[b]=!0,e){case"checkbox":if(b.indexOf("[]")){//multiple checkbox
var j=[];$('input[name="'+b+'"]').each(function(){$(this).prop("checked")&&j.push(i.val())}),j.length>0&&(c=j)}else//single checkbox true|false
c=i.prop("checked")?1:0;break;case"radio":$("input[name="+b+"]").each(function(){$(this).prop("checked")&&(c=$(this).val())});break;case"SELECT":-1!=i.val()&&(c=i.val());break;default:c=i.val()}"non-data"===c&&f?g.error[b]=!0:delete g.error[b]}),g},b=function(a,b){
//control button
var c=$(b+" .js-next-button, .js-submit-button");a?c.removeAttr("disabled"):c.attr("disabled","disabled")},c=function(c){c="#form_"+c;var d={};$(document).on("change",c+" .js-answer-key, .js-submit-button",function(){$(this).attr("data-required")?(d=a(c),jQuery.isEmptyObject(d.error)?b(!0,c):b(!1,c)):b(!0,c)}),d=null};return{getFormData:a,formControl:b,actionValid:c}}(jQuery),d.elements=function(){return{selectBox:function(){$(".select__box").each(function(){var a=$(this).children(".select__box__actual"),b=a.find("option:selected");$(this).prepend('<label class="select__box__label">'+b.text().substr(0,20)+"</label>"),$(this).children(".select__box__label").length>1&&$(this).children(".select__box__label:first-child").remove();var c=$(this).children(".select__box__label");a.on("change",function(){var a=$(this),b=a.find("option:selected");c.text(b.text().substr(0,20)),a.blur()})})}}}(jQuery),d.form=function(){
// Templates for questions and answers
var b,f={},g="001",h="#risk-reduction-score",i=["001","002","003","004","005-1","005-2","005-3","005-4","006","007-1","007-2","007-3","007-4","007-5","007-6","007-7","008","009","010","011","013","015","017","018","020","022","023","024","027","030","031","032","033","034","035"];$.templates("tmplTopic",'<div class="form-topic js-form_{{:#data.current}}" id="form_{{:#data.current}}" style="display: none;">  <h3 class="topic__title c">{{:main.title}}</h3>  <div class="topic__cover {{:main.image}}">  </div>  <button type="button" name="next-question" class="btn btn-block btn__regular long btn__regular--uppercase js-next-button" data-form="{{:#data.next}}">Next</button></div>'),$.templates("tmplQuestionMain",'<div class="form-question js-form_{{:#data.current}}" id="form_{{:#data.current}}" style="display: none;">  <div class="question__cat {{:main.id}}">    <span class="question__icon {{:main.image}}"></span><span class="question__group">{{:main.group}}</span>  </div>  <div class="question__main">    {{if !main.label}}    <h3 class="question__title--first c">{{:main.title}}</h3>    {{if main.help}}<p class="question__help c">{{:main.help}}</p>{{/if}}    {{else !main.title}}    <h4 class="question__title--second c">{{:main.label}}</h4>    {{if main.help}}<p class="question__help c">{{:main.help}}</p>{{/if}}    {{else}}    <h3 class="question__title--first c">{{:main.title}}</h3>    {{if main.help}}<p class="question__help c">{{:main.help}}</p>{{/if}}    <div class="hr-line"></div>    <h4 class="question__title--second c">{{:main.label}}</h4>    {{/if}}    {{if main.answers.template == "radio-circle"}}      {{include main.answers tmpl="tmplRadioCircle" ~data=#data.main ~current=#data.current /}}    {{else main.answers.template == "checkbox-option"}}      {{include main.answers tmpl="tmplCheckbox" ~data=#data.main ~current=#data.current /}}    {{else main.answers.template == "radio-regular"}}      {{include main.answers tmpl="tmplRadioRegular" ~data=#data.main ~current=#data.current /}}    {{else main.answers.template == "select-option"}}      {{include main.answers tmpl="tmplSelect" ~data=#data.main ~current=#data.current /}}    {{/if}}  </div>  {{if #data.next}}    {{if #data.current == "008" || #data.current == "009" || #data.current == "031"}}  <button type="button" name="next" class="btn btn-block btn__regular long btn__regular--uppercase js-next-button" id="btn_form_{{:#data.current}}" data-form="{{:#data.next}}">Next</button>    {{else}}  <button type="button" name="next" class="btn btn-block btn__regular long btn__regular--uppercase js-next-button" id="btn_form_{{:#data.current}}" data-form="{{:#data.next}}" disabled="">Next</button>    {{/if}}  {{else}}  <button type="submit" name="" class="btn btn-block btn__regular long btn__regular--uppercase js-submit-button" id="btn_form_{{:#data.current}}" disabled="">Next</button>  {{/if}}</div>'),$.templates("tmplQuestionInherit",'<div class="form-question js-form_{{:#data.current}}" id="form_{{:#data.current}}">  <div class="question__cat {{:#data.main.id}}">    <span class="question__icon {{:#data.main.image}}"></span><span class="question__group">{{:#data.main.group}}</span>  </div>  {{props #data.inherit ~data=#data.main}}  <div class="question__main">    <h4 class="question__title--second c">Are you currently using treatment to control <span class="b">{{>prop}}</span>? Please mark all that apply.</h4>    <div id="{{:~data.id}}_{{>key}}" class="answers">      {{props ~data.answers.list ~key=key}}      <div class="radio__regular">        <input type="radio" class="radio__regular__input js-answer-key" id="{{:~data.id}}_{{:~key}}{{>key}}" name="{{:~data.id}}_{{:~key}}" value="{{>key}}" data-required="true">        <label class="radio__regular__label" for="{{:~data.id}}_{{:~key}}{{>key}}">{{>prop}}</label>      </div>      {{/props}}    </div>  </div>  {{/props}}  <button type="button" name="next" class="btn btn-block btn__regular long btn__regular--uppercase js-next-button" id="btn_form_{{:#data.current}}" data-form="{{:#data.next}}" disabled="">Next</button></div>'),$.templates("tmplQuestionDepend",'<div class="question__depend">  <h4 class="question__title--second c">{{:label}}</h4>  {{if help}}<p class="question__help">{{:help}}</p>{{/if}}  {{if answers.template == "radio-circle"}}    {{include answers tmpl="tmplRadioCircle" ~data=#data ~current=#data.current /}}  {{else answers.template == "checkbox-option"}}    {{include answers tmpl="tmplCheckbox" ~data=#data ~current=#data.current /}}  {{else answers.template == "radio-regular"}}    {{include answers tmpl="tmplRadioRegular" ~data=#data ~current=#data.current /}}  {{else answers.template == "select-option"}}    {{include answers tmpl="tmplSelect" ~data=#data ~current=#data.current /}}  {{/if}}</div>'),$.templates("tmplRadioCircle",'{{if list.length == 5}}<div id="{{:~data.id}}" class="answers answers--5">{{else list.length == 6}}<div id="{{:~data.id}}" class="answers answers--6">{{else list.length == 8}}<div id="{{:~data.id}}" class="answers answers--8">{{else}}<div id="{{:~data.id}}" class="answers">{{/if}}  <div class="answers__list">    {{props list ~default=default ~logical=logical ~suffix=suffix}}      {{if key == 6 && prop == "Don\'t know"}}  </div>  {{if ~suffix}}<div class="answers__suffix">{{:~suffix}}</div>{{/if}}  <div class="answers__list">      {{/if}}    <div class="radio__circle">      {{if ~logical}}        {{props ~logical ~item=key}}          {{if key == ~item}}      <input type="radio" class="radio__circle__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}" value="{{>key}}" onclick="PBS.Widget.form.handleLogic(\'{{:~current}}\', \'{{>prop}}\', this);"{{if ~item == ~default}} checked=""{{/if}} data-required="true">          {{/if}}        {{/props}}      {{else}}      <input type="radio" class="radio__circle__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}" value="{{>key}}" {{if key == ~default}} checked=""{{/if}} data-required="true">      {{/if}}      <label for="{{:~data.id}}_{{>key}}" class="radio__circle__inner{{if prop == "Don\'t know"}} radio__circle__inner--long{{/if}}">{{>prop}}</label>    </div>      {{if key == 6 && prop == "Don\'t know"}}  </div>      {{/if}}    {{/props}}  </div>  {{if list[6] !== "Don\'t know"}}    {{if suffix}}<div class="answers__suffix">{{:suffix}}</div>{{/if}}  {{/if}}</div>'),$.templates("tmplRadioRegular",'<div id="{{:~data.id}}" class="answers">  {{props list ~default=default ~logical=logical}}  <div class="radio__regular">    {{if ~logical}}      {{props ~logical ~item=key}}        {{if key == ~item}}    <input type="radio" class="radio__regular__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}" value="{{>key}}" onclick="PBS.Widget.form.handleLogic(\'{{:~current}}\', \'{{>prop}}\', this);"{{if key == ~default}} checked=""{{/if}} data-required="true">        {{/if}}      {{/props}}    {{else}}    <input type="radio" class="radio__regular__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}" value="{{>key}}"{{if key == ~default}} checked=""{{/if}} data-required="true">    {{/if}}    <label class="radio__regular__label" for="{{:~data.id}}_{{>key}}">{{>prop}}</label>  </div>  {{/props}}  {{if suffix}}<div class="answers__suffix">{{:suffix}}</div>{{/if}}</div>'),$.templates("tmplCheckbox",'<div id="{{:~data.id}}" class="answers">  {{props list ~default=default ~logical=logical}}  <div class="checkbox__styled">    {{if ~logical}}    <input type="checkbox" class="checkbox__styled__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}[]" value="{{>key}}" onchange="PBS.Widget.form.handleLogic(this, \'{{:~logical}}\');"{{props ~default ~item=key}}{{if prop == ~item}} checked=""{{/if}}{{/props}}{{if ~current != "031"}} data-required="true"{{/if}}>    {{else}}    <input type="checkbox" class="checkbox__styled__input js-answer-key" id="{{:~data.id}}_{{>key}}" name="{{:~data.id}}[]" value="{{>key}}"{{props ~default ~item=key}}{{if prop == ~item}} checked=""{{/if}}{{/props}}{{if ~current != "031"}} data-required="true"{{/if}}>    {{/if}}    <label class="checkbox__styled__label" for="{{:~data.id}}_{{>key}}">{{>prop}}</label>  </div>  {{/props}}  {{if suffix}}<div class="answers__suffix">{{:suffix}}</div>{{/if}}</div>'),$.templates("tmplSelect",'<div id="{{:~data.id}}" class="answers">  <div class="select__box">    <select class="select__box__actual js-answer-key" name="{{:~data.id}}"{{if logical}} onchange="PBS.Widget.form.handleLogic(\'{{:~current}}\', \'{{:logical}}\', this);"{{/if}} data-required="true">      {{if ~current == "018" || ~current == "020" || ~current == "021"}}      <option value="-1">Select your answer</option>      {{/if}}      {{props list ~default=default}}      <option value="{{>key}}"{{if key == ~default}} selected=""{{/if}}>{{>prop}}</option>      {{/props}}    </select>  </div>  {{if suffix}}<div class="answers__suffix">{{:suffix}}</div>{{/if}}</div>');
// Handle browser history for "Back" case
var j=function(b){a.location.hash="#"+b,e.rrs.handleGA(b)},k=function(b){a.location.hash="#"+b},l=function(a,c){
// Read into the specified form, eg. data.001: {}
var e,g;if(g=b[a],"032"==a)delete g.inherit,g.inherit||(g.inherit=f),e=$.render.tmplQuestionInherit(g);else switch(g.main.type){case"topic":e=$.render.tmplTopic(g);break;case"question":e=$.render.tmplQuestionMain(g);break;default:e=null}c?$(e).insertAfter("#form_"+c):$(h).append(e),"027"==a&&(m(a),m(a,1)),d.elements.selectBox(),g=e=null},m=function(a,c){for(var e,f=b[a].depend,g="#form_"+a,h=0;h<f.length;h++)f[h].current=b[a].current;c?(e=$.render.tmplQuestionDepend(f[1]),$(e).insertAfter(g+" > .question__depend:eq(0)")):(e=$.render.tmplQuestionDepend(f[0]),$(e).insertAfter(g+" > .question__main")),d.elements.selectBox(),e=f=null},n=function(a,b,d){if(d){var e="#"+d.id;$(e).off("change")}if(null!==a&&"object"!=typeof a)var g=$("#form_"+a);var h=b.split("-"),j=b;switch(h!=b&&(j=h[0]),j){case"paintDepend":h[1]?1==g.children(".question__depend").length&&m(a,2):g.children(".question__depend").length||m(a);break;case"destroyDepend":"013"==a&&$("#btn_form_013").attr("data-form","017"),g.children(".question__depend").remove();break;case"collectData":"031"==h[1]&&($("#btn_form_031").attr("data-form","032"),a.checked&&!f[a.value]?f[a.value]=$("#"+a.id).next().text():delete f[a.value],a=a.id);break;case"skippable":1==g.children(".js-next-button").length&&$("#btn_form_"+a).attr("data-form",h[1]);break;case"skipHistory":var n=i[i.indexOf(a)-1],o=$("#form_"+n),p=i[i.indexOf(a)-2],q=$("#form_"+p);"noskip"==h[1]?0==g.length?l(a,n):"032"==a&&(g.remove(),l(a,n)):0==g.length&&l(a,p),k(a),q.hide(),o.hide()}c.validation.actionValid(a),d&&$(e).trigger("change")},o=function(){var a=new $.Deferred;return $.getJSON("../data/data.min.json").success(function(c){b=c,a.resolve()}),a.promise()},p=function(a){var b=i.length,c=i.indexOf(a)+1,d=c/b*100;d=d.toFixed(0),$(".percent").animate({left:d+"%"},{duration:800,start:function(){$(".progress__bar__current").animate({width:d+"%"},800)}},800),$(".progress__bar__current span").text(d)},q=function(a){j(g);var c=$.render.tmplTopic(b[g]);$(h).append(c),$("#form_"+g).show(),c=null};return{formList:i,readData:o,renderMain:l,renderDepend:m,initialRender:q,handleLogic:n,handleProgess:p,historyPush:j,historyReplace:k}}(jQuery),d.surveyModule=function(a){var b=a(".js-render-reply"),c=function(){d()},d=function(){a(".js-choice-reply").on("change",function(){e(a(this))})},e=function(c){if(c.prop("checked")){var d=c.val();b.filter('[data-reply!="'+d+'"]').addClass("is-hidden"),b.filter('[data-reply="'+d+'"]').removeClass("is-hidden"),a('input[name="'+d+'-willing"]').prop("checked",!1)}};return{init:c}}(jQuery),e.all=function(a){var b=function(){a(function(){FastClick.attach(document.body)})};return{init:b}}(jQuery),e.rrs=function(b){var e,f,g,h,i,j,k,l,m=!1,n=function(){d.form.readData().done(function(){d.form.initialRender()}),b(a).on("hashchange",function(e){m=!0,f=a.location.hash.split("#")[1],i=d.form.formList.indexOf(f),l=b("#form_"+f),h=d.form.formList[i-1],k=b("#form_"+h),g=d.form.formList[i+1],j=b("#form_"+g);var n=d.form.formList[i-2],q=b("#form_"+n),r=d.form.formList[i+2],s=b("#form_"+r);j.length||s.length||(m=!1),b("html body").animate({scrollTop:0},"fast"),j.length?j.hide():s.hide(),k.length?k.hide():q.hide(),l.show(),d.form.handleProgess(f),c.validation.actionValid(f),o(f),p(f)}),b(document).on("click",".js-next-button",function(){l=b(this).parent();var a=l.attr("id").split("_")[1];if(e=b(this).attr("data-form"),j=b("#form_"+e),m){if("032"==e){var f=[];b("#medical_depression").find(".js-answer-key:checked").each(function(){f.push(b(this).val())}),0==f.length&&(e="033"),f=null}"015"==e||"017"==e||"032"==e||"033"==e?"015"==e||"032"==e?d.form.handleLogic(e,"skipHistory-noskip"):("013"==a?b("#form_015").remove():"031"==a&&b("#form_032").remove(),d.form.handleLogic(e,"skipHistory-skippable")):d.form.historyReplace(e)}else{if("032"==e){var f=[];b("#medical_depression").find(".js-answer-key:checked").each(function(){f.push(b(this).val())}),0==f.length&&(e="033"),f=null}l.hide(),d.form.historyPush(e),d.form.renderMain(e),b("html body").animate({scrollTop:0},"fast"),b("#form_"+e).show(),o(e),d.form.handleProgess(e),c.validation.actionValid(e)}})},o=function(a){b("#form_"+a).hasClass("form-question")?b(".progress").removeClass("hidden"):b(".progress").addClass("hidden")},p=function(a){ga("set","page","/rrs/"+a),ga("send","pageview")};return{init:n,handleGA:p}}(jQuery),e.profile=function(a){var b=function(){var b=(new Date).getFullYear();a.validator.addMethod("birth",function(a,c){var d=a.split("-");return parseInt(d[0])<=b-18&&parseInt(d[0])>=b-90},"Please enter a year greater than "+(b-90)+" and smaller than "+(b-18)+"."),a("#form_profile").validate({ignore:[],onfocusout:!1,invalidHandler:function(b,c){var d=c.numberOfInvalids(),e=c.errorList;d>0&&(a.each(e,function(a,b){"name_first"==b.element.name?b.element.name="first_name":"name_last"==b.element.name?b.element.name="last_name":"mobile_phone"==b.element.name?b.element.name="mobile_no":"height"==b.element.name?ga("send","event","form_039","height_unit","validation",null):"weight"==b.element.name&&ga("send","event","form_039","weight_unit","validation",null),ga("send","event","form_039",b.element.name,"validation",null)}),ga("send","event","form_039","new_letter_flg","validation",null))},errorElement:"div",errorClass:"error_message",rules:{name_first:{required:!0,minlength:1,maxlength:50},name_last:{minlength:1,maxlength:50},email:{required:!0,email:!0,rangelength:[1,255]},mobile_phone:{number:!0,rangelength:[10,16]},zip_code:{number:!0,minlength:5,maxlength:5},birthday:{required:!0,date:!1,dateISO:!0,birth:!0},gender:{required:!0},height:{required:!0,number:!0,min:12,max:84},weight:{required:!0,number:!0,min:60,max:1e3}}}),a(document).on("change",'input[name="height_unit"]',function(){"cm"==a(this).val()?a('input[name="height"]').rules("add",{min:100,max:200}):a('input[name="height"]').rules("add",{min:12,max:84}),a("#height").valid()}),a(document).on("change",'input[name="weight_unit"]',function(){"kg"==a(this).val()?a('input[name="weight"]').rules("add",{min:27,max:450}):a('input[name="weight"]').rules("add",{min:60,max:1e3}),a("#weight").valid()})};return{init:b}}(jQuery),e.survey=function(a){var b=function(){d.elements.selectBox(),d.surveyModule.init(),a(".survey__form").validate({ignore:[],onfocusout:!1,invalidHandler:function(b,c){var d=c.numberOfInvalids(),e=c.errorList;d>0&&(a.each(e,function(a,b){"other_specify"==b.element.name?ga("send","event","Survey","program_why_not","validation",null):ga("send","event","Survey","program_how_much","validation",null),ga("send","event","Survey",b.element.name,"validation",null)}),ga("send","event","Survey","satisfaction_why","validation",null),ga("send","event","Survey","recommendation","validation",null),ga("send","event","Survey","free comment","validation",null))},errorElement:"div",errorClass:"error_message",rules:{satisfaction:{required:!0},satisfaction_why:{maxlength:3e3},program_want_to_try:{required:!0},other_specify:{maxlength:500},free_comment:{maxlength:3e3}}})};return{init:b}}(jQuery),e.score=function(a){var b=a("#js-score-up").attr("data-score"),c=a("#activity").attr("data-value"),d=a("#diet").attr("data-value"),e=a("#lifestyle").attr("data-value"),f=a("#medical").attr("data-value"),g={animationEasing:"linear",showTooltips:!1,segmentShowStroke:!1},h={diet:[{value:d,color:"#68ace5"},{value:100-d,color:"#717171"}],activity:[{value:c,color:"#68ace5"},{value:100-c,color:"#717171"}],lifestyle:[{value:e,color:"#68ace5"},{value:100-e,color:"#717171"}],medical:[{value:f,color:"#68ace5"},{value:100-f,color:"#717171"}]},i=function(){var c=new CountUp("js-score-up",0,b,0,2.5,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"",suffix:""});c.start(),Chart.types.Pie.extend({name:"PieAlt",draw:function(){Chart.types.Pie.prototype.draw.apply(this,arguments),this.chart.ctx.font='bold 36px "Source Sans Pro"',this.chart.ctx.fillStyle="white",this.chart.ctx.textBaseline="middle","100"==this.segments[0].value?this.chart.ctx.fillText(this.segments[0].value+"%",this.chart.width/2-43,this.chart.width/2,100):this.chart.ctx.fillText(this.segments[0].value+"%",this.chart.width/2-35,this.chart.width/2,100)}});var d=document.getElementById("activity").getContext("2d"),e=(new Chart(d).PieAlt(h.activity,g),document.getElementById("diet").getContext("2d")),f=(new Chart(e).PieAlt(h.diet,g),document.getElementById("lifestyle").getContext("2d")),i=(new Chart(f).PieAlt(h.lifestyle,g),document.getElementById("medical").getContext("2d"));new Chart(i).PieAlt(h.medical,g);a(".see_detail").click(function(b){var c=a(this).text();a(this).text("See detail"==c?"Hide detail":"See detail"),a(this).toggleClass("active"),a(this).parent().parent().toggleClass("active"),a(this).parent().parent().find(".detail__information").slideToggle(),b.preventDefault()});var j=function(){a(".topic").each(function(){var b=a(this).parent().find(".topic__content").position().top-65;a(this).find(".drop__toggle").click(function(c){c.preventDefault();var d=a(this).text();a(this).text("Hide reason/advise"==d?"See reason/advise":"Hide reason/advise"),a(this).toggleClass("active"),a(this).parent().parent().find(".topic__content").is(":visible")?(a(this).parent().parent().find(".topic__content").slideUp(500),a(".content").animate({scrollTop:b},"800")):a(this).parent().parent().find(".topic__content").slideDown(500)})})};j()};return{init:i}}(jQuery)}(this);
//# sourceMappingURL=wall.min.js.map